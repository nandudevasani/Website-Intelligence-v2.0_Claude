<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Website Intelligence ‚Äî Domain Analyzer</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
      --bg-primary:#0a0e17;--bg-secondary:#111827;--bg-card:#151d2e;--bg-card-hover:#1a2540;
      --border:#1e2a42;--border-glow:#2563eb33;--text-primary:#e8edf5;--text-secondary:#8896b0;--text-muted:#4a5875;
      --accent:#3b82f6;--accent-glow:#3b82f640;
      --green:#22c55e;--green-bg:#22c55e15;--red:#ef4444;--red-bg:#ef444415;
      --orange:#f59e0b;--orange-bg:#f59e0b15;--yellow:#eab308;--yellow-bg:#eab30815;
      --purple:#a855f7;--purple-bg:#a855f715;--cyan:#06b6d4;--cyan-bg:#06b6d415;
      --blue:#3b82f6;--blue-bg:#3b82f615;
    }
    html{scroll-behavior:smooth}
    body{font-family:'DM Sans',system-ui,sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;line-height:1.6}
    .bg-grid{position:fixed;inset:0;background-image:linear-gradient(rgba(59,130,246,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(59,130,246,.03) 1px,transparent 1px);background-size:60px 60px;pointer-events:none;z-index:0}
    .bg-glow{position:fixed;top:-200px;left:50%;transform:translateX(-50%);width:800px;height:600px;background:radial-gradient(ellipse,rgba(59,130,246,.08),transparent 70%);pointer-events:none;z-index:0}
    .container{position:relative;z-index:1;max-width:1100px;margin:0 auto;padding:2rem 1.5rem 4rem}

    .header{text-align:center;padding:3rem 0 2.5rem}
    .header-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;background:var(--bg-card);border:1px solid var(--border);border-radius:100px;font-size:.75rem;font-weight:600;color:var(--accent);letter-spacing:.08em;text-transform:uppercase;margin-bottom:1.25rem}
    .header-badge .dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:pulse-dot 2s infinite}
    @keyframes pulse-dot{0%,100%{opacity:1}50%{opacity:.4}}
    .header h1{font-family:'JetBrains Mono',monospace;font-size:2.2rem;font-weight:700;letter-spacing:-.03em;margin-bottom:.5rem;background:linear-gradient(135deg,#e8edf5,#8896b0);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .header p{color:var(--text-secondary);font-size:1rem;max-width:520px;margin:0 auto}

    .search-section{display:flex;gap:10px;margin-bottom:2rem;max-width:700px;margin-left:auto;margin-right:auto}
    .search-input-wrap{flex:1;position:relative}
    .search-input-wrap .icon{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:var(--text-muted);pointer-events:none}
    .search-input{width:100%;padding:14px 16px 14px 46px;background:var(--bg-card);border:1px solid var(--border);border-radius:12px;color:var(--text-primary);font-size:1rem;font-family:'JetBrains Mono',monospace;outline:none;transition:border-color .2s,box-shadow .2s}
    .search-input::placeholder{color:var(--text-muted)}
    .search-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-glow)}
    .btn{padding:14px 28px;background:var(--accent);border:none;border-radius:12px;color:#fff;font-size:.95rem;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap;font-family:'DM Sans',sans-serif}
    .btn:hover{background:#2563eb;transform:translateY(-1px);box-shadow:0 4px 20px var(--accent-glow)}
    .btn:active{transform:translateY(0)}.btn:disabled{opacity:.5;cursor:not-allowed;transform:none}

    .tabs{display:flex;gap:4px;margin-bottom:2rem;max-width:700px;margin-left:auto;margin-right:auto;background:var(--bg-secondary);border-radius:10px;padding:4px}
    .tab{flex:1;padding:10px;background:none;border:none;border-radius:8px;color:var(--text-secondary);font-size:.85rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:'DM Sans',sans-serif}
    .tab:hover{color:var(--text-primary)}.tab.active{background:var(--bg-card);color:var(--text-primary);box-shadow:0 1px 4px rgba(0,0,0,.2)}

    .bulk-input{display:none;max-width:700px;margin:0 auto 2rem}.bulk-input.visible{display:block}
    .bulk-textarea{width:100%;height:140px;padding:14px 16px;background:var(--bg-card);border:1px solid var(--border);border-radius:12px;color:var(--text-primary);font-family:'JetBrains Mono',monospace;font-size:.9rem;outline:none;resize:vertical;transition:border-color .2s,box-shadow .2s;margin-bottom:10px}
    .bulk-textarea::placeholder{color:var(--text-muted)}.bulk-textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-glow)}

    .loader{display:none;text-align:center;padding:3rem}.loader.visible{display:block}
    .spinner{width:44px;height:44px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 1rem}
    @keyframes spin{to{transform:rotate(360deg)}}
    .loader-text{color:var(--text-secondary);font-size:.9rem}
    .loader-domain{font-family:'JetBrains Mono',monospace;color:var(--accent);font-weight:600}

    .results{display:none}.results.visible{display:block}

    .status-hero{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;padding:2rem;margin-bottom:1.5rem;display:flex;align-items:center;gap:1.5rem;position:relative;overflow:hidden}
    .status-hero::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
    .status-hero[data-color="green"]::before{background:linear-gradient(90deg,var(--green),#10b981)}
    .status-hero[data-color="red"]::before{background:linear-gradient(90deg,var(--red),#dc2626)}
    .status-hero[data-color="orange"]::before{background:linear-gradient(90deg,var(--orange),#d97706)}
    .status-hero[data-color="yellow"]::before{background:linear-gradient(90deg,var(--yellow),#ca8a04)}
    .status-hero[data-color="blue"]::before{background:linear-gradient(90deg,var(--blue),#2563eb)}

    .status-icon{width:64px;height:64px;border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:1.8rem;flex-shrink:0}
    .status-icon.green{background:var(--green-bg)}.status-icon.red{background:var(--red-bg)}.status-icon.orange{background:var(--orange-bg)}.status-icon.yellow{background:var(--yellow-bg)}.status-icon.blue{background:var(--blue-bg)}
    .status-info{flex:1}
    .status-domain{font-family:'JetBrains Mono',monospace;font-size:1.25rem;font-weight:700;margin-bottom:4px}
    .status-label{display:inline-flex;align-items:center;gap:6px;padding:4px 12px;border-radius:100px;font-size:.78rem;font-weight:700;letter-spacing:.06em;text-transform:uppercase}
    .status-label.green{background:var(--green-bg);color:var(--green)}.status-label.red{background:var(--red-bg);color:var(--red)}.status-label.orange{background:var(--orange-bg);color:var(--orange)}.status-label.yellow{background:var(--yellow-bg);color:var(--yellow)}.status-label.blue{background:var(--blue-bg);color:var(--blue)}
    .status-reason{color:var(--text-secondary);font-size:.9rem;margin-top:6px}
    .status-meta{text-align:right;flex-shrink:0}
    .status-meta-item{font-size:.8rem;color:var(--text-muted);margin-bottom:4px}
    .status-meta-item span{color:var(--text-secondary);font-family:'JetBrains Mono',monospace;font-weight:500}

    .cards-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:1rem;margin-bottom:1.5rem}
    .card{background:var(--bg-card);border:1px solid var(--border);border-radius:14px;padding:1.5rem;transition:border-color .2s}
    .card:hover{border-color:var(--border-glow)}
    .card-header{display:flex;align-items:center;gap:10px;margin-bottom:1.25rem}
    .card-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1rem}
    .card-icon.blue{background:rgba(59,130,246,.15)}.card-icon.green{background:var(--green-bg)}.card-icon.purple{background:var(--purple-bg)}.card-icon.cyan{background:var(--cyan-bg)}.card-icon.orange{background:var(--orange-bg)}.card-icon.red{background:var(--red-bg)}
    .card-title{font-weight:700;font-size:.95rem}

    .info-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border)}
    .info-row:last-child{border-bottom:none}
    .info-label{color:var(--text-muted);font-size:.82rem;font-weight:500}
    .info-value{font-family:'JetBrains Mono',monospace;font-size:.82rem;color:var(--text-primary);font-weight:500;text-align:right;max-width:60%;word-break:break-all}
    .info-value.green{color:var(--green)}.info-value.red{color:var(--red)}.info-value.orange{color:var(--orange)}.info-value.yellow{color:var(--yellow)}.info-value.blue{color:var(--blue)}

    .content-card{grid-column:1/-1}
    .content-verdict{padding:1rem 1.25rem;border-radius:10px;margin-bottom:1rem;display:flex;align-items:center;gap:12px}
    .content-verdict.green{background:var(--green-bg);border:1px solid rgba(34,197,94,.2)}.content-verdict.red{background:var(--red-bg);border:1px solid rgba(239,68,68,.2)}.content-verdict.orange{background:var(--orange-bg);border:1px solid rgba(245,158,11,.2)}.content-verdict.yellow{background:var(--yellow-bg);border:1px solid rgba(234,179,8,.2)}.content-verdict.blue{background:var(--blue-bg);border:1px solid rgba(59,130,246,.2)}
    .content-verdict-text{font-weight:700;font-size:.95rem}
    .content-verdict.green .content-verdict-text{color:var(--green)}.content-verdict.red .content-verdict-text{color:var(--red)}.content-verdict.orange .content-verdict-text{color:var(--orange)}.content-verdict.yellow .content-verdict-text{color:var(--yellow)}.content-verdict.blue .content-verdict-text{color:var(--blue)}
    .content-confidence{margin-left:auto;font-family:'JetBrains Mono',monospace;font-size:.85rem;font-weight:600}

    .content-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:10px}
    .content-stat{background:var(--bg-secondary);border-radius:10px;padding:12px;text-align:center}
    .content-stat-value{font-family:'JetBrains Mono',monospace;font-size:1.3rem;font-weight:700;color:var(--accent)}
    .content-stat-label{font-size:.72rem;color:var(--text-muted);font-weight:600;text-transform:uppercase;letter-spacing:.05em;margin-top:4px}

    .flags-wrap{display:flex;flex-wrap:wrap;gap:6px;margin-top:10px}
    .flag-badge{padding:3px 10px;border-radius:6px;font-size:.72rem;font-weight:700;letter-spacing:.04em;text-transform:uppercase;background:var(--bg-secondary);color:var(--text-muted);border:1px solid var(--border)}
    .flag-badge.warn{background:var(--red-bg);color:var(--red);border-color:rgba(239,68,68,.2)}
    .flag-badge.info{background:var(--blue-bg);color:var(--blue);border-color:rgba(59,130,246,.2)}

    .redirect-box{background:var(--red-bg);border:1px solid rgba(239,68,68,.2);border-radius:10px;padding:1rem;margin-top:10px}
    .redirect-box-title{font-weight:700;font-size:.85rem;color:var(--red);margin-bottom:6px}
    .redirect-box-detail{font-size:.82rem;color:var(--text-secondary);margin-bottom:2px}
    .redirect-box-detail span{font-family:'JetBrains Mono',monospace;color:var(--text-primary)}

    .bulk-results{display:none}.bulk-results.visible{display:block}
    .bulk-table-wrap{background:var(--bg-card);border:1px solid var(--border);border-radius:14px;overflow-x:auto}
    .bulk-table{width:100%;border-collapse:collapse}
    .bulk-table th{text-align:left;padding:12px 16px;background:var(--bg-secondary);font-size:.75rem;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:.06em;border-bottom:1px solid var(--border)}
    .bulk-table td{padding:12px 16px;font-size:.85rem;border-bottom:1px solid var(--border)}
    .bulk-table tr:last-child td{border-bottom:none}
    .bulk-table tr:hover{background:var(--bg-card-hover)}
    .bulk-domain{font-family:'JetBrains Mono',monospace;font-weight:600;color:var(--text-primary)}
    .bulk-status-badge{display:inline-block;padding:3px 10px;border-radius:6px;font-size:.73rem;font-weight:700;letter-spacing:.04em;text-transform:uppercase}
    .bulk-status-badge.ACTIVE{background:var(--green-bg);color:var(--green)}
    .bulk-status-badge.DEAD,.bulk-status-badge.DOWN,.bulk-status-badge.SUSPENDED,.bulk-status-badge.CROSS_DOMAIN_REDIRECT{background:var(--red-bg);color:var(--red)}
    .bulk-status-badge.PARKED,.bulk-status-badge.NO_CONTENT,.bulk-status-badge.REDIRECT_HOST,.bulk-status-badge.DEFAULT_PAGE,.bulk-status-badge.SHELL_SITE{background:var(--orange-bg);color:var(--orange)}
    .bulk-status-badge.COMING_SOON,.bulk-status-badge.ISSUES{background:var(--yellow-bg);color:var(--yellow)}
    .bulk-status-badge.POLITICAL_CAMPAIGN{background:var(--blue-bg);color:var(--blue)}
    .bulk-status-badge.ERROR{background:var(--red-bg);color:var(--red)}
    .bulk-valid{font-weight:700}.bulk-valid.yes{color:var(--green)}.bulk-valid.no{color:var(--red)}

    .bulk-summary{display:flex;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap}
    .bulk-summary-item{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1rem 1.5rem;text-align:center;flex:1;min-width:120px}
    .bulk-summary-value{font-family:'JetBrains Mono',monospace;font-size:1.5rem;font-weight:700}
    .bulk-summary-label{font-size:.75rem;color:var(--text-muted);font-weight:600;text-transform:uppercase;letter-spacing:.05em;margin-top:2px}

    .error-box{display:none;background:var(--red-bg);border:1px solid rgba(239,68,68,.3);border-radius:12px;padding:1.25rem 1.5rem;margin-bottom:1.5rem;color:var(--red);font-weight:500}.error-box.visible{display:block}

    @media(max-width:640px){.header h1{font-size:1.5rem}.search-section{flex-direction:column}.status-hero{flex-direction:column;text-align:center}.status-meta{text-align:center}.cards-grid{grid-template-columns:1fr}.content-stats{grid-template-columns:repeat(2,1fr)}}
  </style>
</head>
<body>
  <div class="bg-grid"></div><div class="bg-glow"></div>
  <div class="container">
    <header class="header">
      <div class="header-badge"><span class="dot"></span> Intelligence Engine v2</div>
      <h1>Website Intelligence</h1>
      <p>Detect parked domains, shell sites, cross-domain redirects, coming soon pages, political campaigns & more.</p>
    </header>

    <div class="tabs">
      <button class="tab active" data-tab="single" onclick="switchTab('single')">Single Domain</button>
      <button class="tab" data-tab="bulk" onclick="switchTab('bulk')">Bulk Analysis</button>
    </div>

    <div class="search-section" id="single-search">
      <div class="search-input-wrap">
        <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" class="search-input" id="domain-input" placeholder="Enter domain (e.g. example.com)" autocomplete="off" spellcheck="false">
      </div>
      <button class="btn" id="analyze-btn" onclick="analyzeDomain()">Analyze</button>
    </div>

    <div class="bulk-input" id="bulk-section">
      <textarea class="bulk-textarea" id="bulk-input-ta" placeholder="Enter domains, one per line (max 20):&#10;example.com&#10;google.com&#10;test.com"></textarea>
      <button class="btn" id="bulk-btn" onclick="analyzeBulk()" style="width:100%">Analyze All</button>
    </div>

    <div class="error-box" id="error-box"></div>
    <div class="loader" id="loader"><div class="spinner"></div><div class="loader-text">Analyzing <span class="loader-domain" id="loader-domain">...</span></div><div class="loader-text" style="margin-top:4px;font-size:.8rem;color:var(--text-muted)">Checking DNS, SSL, HTTP & content intelligence...</div></div>

    <div class="results" id="results">
      <div class="status-hero" id="status-hero" data-color="green">
        <div class="status-icon green" id="status-icon">‚úì</div>
        <div class="status-info">
          <div class="status-domain" id="result-domain">example.com</div>
          <span class="status-label green" id="status-label">ACTIVE</span>
          <div class="status-reason" id="status-reason"></div>
        </div>
        <div class="status-meta">
          <div class="status-meta-item">Response <span id="meta-response">‚Äî</span></div>
          <div class="status-meta-item">HTTP <span id="meta-http">‚Äî</span></div>
          <div class="status-meta-item">SSL <span id="meta-ssl">‚Äî</span></div>
        </div>
      </div>

      <div class="cards-grid">
        <div class="card"><div class="card-header"><div class="card-icon blue">‚ö°</div><div class="card-title">HTTP Status</div></div><div id="http-details"></div></div>
        <div class="card"><div class="card-header"><div class="card-icon green">üîí</div><div class="card-title">SSL Certificate</div></div><div id="ssl-details"></div></div>
        <div class="card"><div class="card-header"><div class="card-icon purple">üåê</div><div class="card-title">DNS Records</div></div><div id="dns-details"></div></div>
        <div class="card"><div class="card-header"><div class="card-icon cyan">üñ•</div><div class="card-title">Server Info</div></div><div id="server-details"></div></div>
        <div class="card content-card"><div class="card-header"><div class="card-icon orange">üìä</div><div class="card-title">Content Intelligence</div></div><div id="content-details"></div></div>
      </div>
    </div>

    <div class="bulk-results" id="bulk-results"></div>
  </div>

<script>
const API = window.location.origin;

function switchTab(t) {
  document.querySelectorAll('.tab').forEach(e => e.classList.remove('active'));
  document.querySelector(`[data-tab="${t}"]`).classList.add('active');
  document.getElementById('single-search').style.display = t === 'single' ? 'flex' : 'none';
  document.getElementById('bulk-section').classList.toggle('visible', t === 'bulk');
  document.getElementById('results').classList.remove('visible');
  document.getElementById('bulk-results').classList.remove('visible');
  document.getElementById('error-box').classList.remove('visible');
}

document.getElementById('domain-input').addEventListener('keydown', e => { if (e.key === 'Enter') analyzeDomain(); });

async function analyzeDomain() {
  const d = document.getElementById('domain-input').value.trim();
  if (!d) return;
  showLoader(d); hideAll();
  try {
    const r = await fetch(API + '/api/analyze', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ domain: d }) });
    if (!r.ok) throw new Error('Failed');
    renderResults(await r.json());
  } catch (e) { showError('Failed: ' + e.message); } finally { hideLoader(); }
}

function renderResults(d) {
  document.getElementById('results').classList.add('visible');
  const c = d.statusColor || 'gray';
  document.getElementById('status-hero').setAttribute('data-color', c);
  const icon = document.getElementById('status-icon');
  icon.className = 'status-icon ' + c; icon.textContent = statusEmoji(d.overallStatus);
  document.getElementById('result-domain').textContent = d.domain;
  const lbl = document.getElementById('status-label');
  lbl.className = 'status-label ' + c; lbl.textContent = fmtStatus(d.overallStatus);
  document.getElementById('status-reason').textContent = d.content?.reasons?.[0] || '';
  document.getElementById('meta-response').textContent = d.http?.responseTime ? d.http.responseTime + 'ms' : '‚Äî';
  document.getElementById('meta-http').textContent = d.http?.statusCode || '‚Äî';
  document.getElementById('meta-ssl').textContent = d.ssl?.valid ? '‚úì Valid' : '‚úó Invalid';

  document.getElementById('http-details').innerHTML = rows([
    ['Status Code', d.http?.statusCode ? d.http.statusCode + ' ' + (d.http.statusText || '') : 'N/A', d.http?.statusCode >= 200 && d.http?.statusCode < 400 ? 'green' : 'red'],
    ['Response Time', d.http?.responseTime ? d.http.responseTime + 'ms' : 'N/A', d.http?.responseTime < 1000 ? 'green' : d.http?.responseTime < 3000 ? 'orange' : 'red'],
    ['Final URL', trunc(d.http?.finalUrl || 'N/A', 40)],
    ['Is Up', d.http?.isUp ? 'Yes' : 'No', d.http?.isUp ? 'green' : 'red']
  ]);

  document.getElementById('ssl-details').innerHTML = rows([
    ['Valid', d.ssl?.valid ? 'Yes' : 'No', d.ssl?.valid ? 'green' : 'red'],
    ['Issuer', d.ssl?.issuer || 'N/A'], ['Subject', d.ssl?.subject || 'N/A'],
    ['Expires', d.ssl?.validTo ? new Date(d.ssl.validTo).toLocaleDateString() : 'N/A'],
    ['Days Left', d.ssl?.daysRemaining != null ? '' + d.ssl.daysRemaining : 'N/A', d.ssl?.daysRemaining > 30 ? 'green' : d.ssl?.daysRemaining > 7 ? 'orange' : 'red'],
    ['Protocol', d.ssl?.protocol || 'N/A']
  ]);

  const dns = d.dns || {};
  document.getElementById('dns-details').innerHTML = rows([
    ['A Records', dns.aRecords?.length > 0 ? dns.aRecords.join(', ') : 'None', dns.hasARecord ? 'green' : 'red'],
    ['MX Records', dns.hasMXRecord ? dns.mxRecords.length + ' found' : 'None', dns.hasMXRecord ? 'green' : 'orange'],
    ['NS Records', dns.nsRecords?.length > 0 ? dns.nsRecords.slice(0, 3).join(', ') : 'None'],
    ['CNAME', dns.cnameRecords?.length > 0 ? dns.cnameRecords.join(', ') : 'None']
  ]);

  document.getElementById('server-details').innerHTML = rows([
    ['Server', d.http?.headers?.server || 'Not disclosed'],
    ['Powered By', d.http?.headers?.poweredBy || 'Not disclosed'],
    ['Content-Type', d.http?.headers?.contentType || 'N/A']
  ]);

  // Content Intelligence
  const ct = d.content || {};
  const vc = verdictColor(ct.verdict);
  let h = '<div class="content-verdict ' + vc + '"><span style="font-size:1.2rem">' + verdictEmoji(ct.verdict) + '</span><span class="content-verdict-text">' + fmtVerdict(ct.verdict) + '</span><span class="content-confidence">' + (ct.confidence || 0) + '% confidence</span></div>';

  if (ct.reasons?.length > 0) h += '<div style="color:var(--text-secondary);font-size:.85rem;margin-bottom:1rem">' + ct.reasons.map(r => '‚Ä¢ ' + esc(r)).join('<br>') + '</div>';

  // Redirect info box
  if (ct.redirectInfo) {
    h += '<div class="redirect-box"><div class="redirect-box-title">‚ö† Cross-Domain Redirect Detected</div>';
    h += '<div class="redirect-box-detail">Source: <span>' + esc(ct.redirectInfo.source) + '</span></div>';
    h += '<div class="redirect-box-detail">Target: <span>' + esc(ct.redirectInfo.target) + '</span></div>';
    h += '<div class="redirect-box-detail">Target Domain: <span>' + esc(ct.redirectInfo.targetDomain) + '</span></div>';
    h += '<div class="redirect-box-detail">Method: <span>' + esc(ct.redirectInfo.method) + '</span></div></div>';
  }

  h += '<div class="content-stats" style="margin-top:1rem">';
  h += stat(ct.details?.wordCount || 0, 'Words') + stat(ct.details?.uniqueWordCount || 0, 'Unique Words');
  h += stat(ct.details?.headings?.length || 0, 'Headings') + stat(ct.details?.images || 0, 'Images');
  h += stat(ct.details?.links?.internal || 0, 'Int. Links') + stat(ct.details?.links?.external || 0, 'Ext. Links');
  h += stat(ct.details?.forms || 0, 'Forms') + '</div>';

  if (ct.details?.title) {
    h += '<div style="margin-top:1rem;padding:10px 14px;background:var(--bg-secondary);border-radius:8px"><span style="font-size:.75rem;color:var(--text-muted);font-weight:600;text-transform:uppercase;letter-spacing:.05em">Page Title</span><br><span style="font-family:\'JetBrains Mono\',monospace;font-size:.85rem;color:var(--text-primary)">' + esc(ct.details.title) + '</span></div>';
  }

  // Detection flags
  if (ct.flags?.length > 0) {
    h += '<div class="flags-wrap" style="margin-top:10px">';
    ct.flags.forEach(f => {
      const warn = ['CROSS_DOMAIN_REDIRECT', 'SUSPICIOUS_REDIRECT_TARGET', 'SHELL_SITE', 'PARKED'].includes(f);
      const info = ['POLITICAL_CAMPAIGN', 'HAS_FEC_DISCLOSURE'].includes(f);
      h += '<span class="flag-badge ' + (warn ? 'warn' : info ? 'info' : '') + '">' + f.replace(/_/g, ' ') + '</span>';
    });
    h += '</div>';
  }

  document.getElementById('content-details').innerHTML = h;
}

async function analyzeBulk() {
  const txt = document.getElementById('bulk-input-ta').value.trim();
  if (!txt) return;
  const doms = txt.split('\n').map(d => d.trim()).filter(d => d.length > 0);
  if (doms.length === 0) return;
  if (doms.length > 20) { showError('Max 20 domains'); return; }
  showLoader(doms.length + ' domains'); hideAll();
  try {
    const r = await fetch(API + '/api/analyze/bulk', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ domains: doms }) });
    if (!r.ok) throw new Error('Failed');
    renderBulk(await r.json());
  } catch (e) { showError('Failed: ' + e.message); } finally { hideLoader(); }
}

function renderBulk(data) {
  const el = document.getElementById('bulk-results');
  el.classList.add('visible');
  const res = data.results || [];
  const active = res.filter(r => r.isGenuinelyValid).length;
  const invalid = res.filter(r => !r.isGenuinelyValid && r.overallStatus !== 'ERROR').length;
  const errs = res.filter(r => r.overallStatus === 'ERROR').length;

  let h = '<div class="bulk-summary">';
  h += sumItem(res.length, 'Total', '--text-primary') + sumItem(active, 'Valid', '--green') + sumItem(invalid, 'Invalid', '--orange') + sumItem(errs, 'Errors', '--red');
  h += '</div><div class="bulk-table-wrap"><table class="bulk-table"><thead><tr><th>Domain</th><th>Status</th><th>Valid?</th><th>HTTP</th><th>Words</th><th>Unique</th><th>Confidence</th><th>Reason</th></tr></thead><tbody>';

  res.forEach(r => {
    h += '<tr><td><span class="bulk-domain">' + esc(r.domain) + '</span></td>';
    h += '<td><span class="bulk-status-badge ' + r.overallStatus + '">' + fmtStatus(r.overallStatus) + '</span></td>';
    h += '<td><span class="bulk-valid ' + (r.isGenuinelyValid ? 'yes' : 'no') + '">' + (r.isGenuinelyValid ? '‚úì YES' : '‚úó NO') + '</span></td>';
    h += '<td style="font-family:\'JetBrains Mono\',monospace;font-size:.82rem">' + (r.statusCode || '‚Äî') + '</td>';
    h += '<td style="font-family:\'JetBrains Mono\',monospace;font-size:.82rem">' + (r.wordCount ?? '‚Äî') + '</td>';
    h += '<td style="font-family:\'JetBrains Mono\',monospace;font-size:.82rem">' + (r.uniqueWordCount ?? '‚Äî') + '</td>';
    h += '<td style="font-family:\'JetBrains Mono\',monospace;font-size:.82rem">' + (r.confidence ? r.confidence + '%' : '‚Äî') + '</td>';
    h += '<td style="color:var(--text-secondary);font-size:.8rem;max-width:220px">' + esc((r.reasons?.[0] || r.error || '').substring(0, 100)) + '</td></tr>';
  });

  h += '</tbody></table></div>';
  el.innerHTML = h;
}

// Helpers
function rows(arr) { return arr.map(([l, v, c]) => '<div class="info-row"><span class="info-label">' + l + '</span><span class="info-value' + (c ? ' ' + c : '') + '">' + esc(String(v)) + '</span></div>').join(''); }
function stat(v, l) { return '<div class="content-stat"><div class="content-stat-value">' + v + '</div><div class="content-stat-label">' + l + '</div></div>'; }
function sumItem(v, l, c) { return '<div class="bulk-summary-item"><div class="bulk-summary-value" style="color:var(' + c + ')">' + v + '</div><div class="bulk-summary-label">' + l + '</div></div>'; }
function showLoader(t) { document.getElementById('loader-domain').textContent = t; document.getElementById('loader').classList.add('visible'); }
function hideLoader() { document.getElementById('loader').classList.remove('visible'); }
function hideAll() { document.getElementById('results').classList.remove('visible'); document.getElementById('bulk-results').classList.remove('visible'); document.getElementById('error-box').classList.remove('visible'); }
function showError(m) { const e = document.getElementById('error-box'); e.textContent = m; e.classList.add('visible'); }
function trunc(s, n) { return s.length > n ? s.substring(0, n) + '‚Ä¶' : s; }
function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

function statusEmoji(s) { return { ACTIVE:'‚úì',DEAD:'‚úó',DOWN:'‚úó',PARKED:'‚äò',COMING_SOON:'‚óî',NO_CONTENT:'‚óã',REDIRECT_HOST:'‚§≥',DEFAULT_PAGE:'‚ñ§',SUSPENDED:'‚äò',SHELL_SITE:'‚óá',CROSS_DOMAIN_REDIRECT:'‚ÜØ',POLITICAL_CAMPAIGN:'‚òÖ',ISSUES:'!',UNKNOWN:'?' }[s] || '?'; }

function fmtStatus(s) { return { ACTIVE:'Active',DEAD:'Dead',DOWN:'Down',PARKED:'Parked / For Sale',COMING_SOON:'Coming Soon',NO_CONTENT:'No Content',REDIRECT_HOST:'Host Redirect',DEFAULT_PAGE:'Default Page',SUSPENDED:'Suspended',SHELL_SITE:'Shell Site',CROSS_DOMAIN_REDIRECT:'Cross-Domain Redirect',POLITICAL_CAMPAIGN:'Political Campaign',ISSUES:'Issues',ERROR:'Error',UNKNOWN:'Unknown' }[s] || s; }

function fmtVerdict(v) { return { VALID:'Genuine Active Website',PARKED:'Parked Domain / For Sale',COMING_SOON:'Coming Soon / Under Construction',NO_CONTENT:'No Meaningful Content',REDIRECT_HOST:'Redirects to Hosting Provider',DEFAULT_PAGE:'Default Server Page',SUSPENDED:'Account Suspended',SHELL_SITE:'Template Shell ‚Äî No Real Content',CROSS_DOMAIN_REDIRECT:'Redirects to Unrelated Domain',POLITICAL_CAMPAIGN:'Political Campaign Site' }[v] || v; }

function verdictColor(v) { return { VALID:'green',PARKED:'orange',COMING_SOON:'yellow',NO_CONTENT:'orange',REDIRECT_HOST:'orange',DEFAULT_PAGE:'orange',SUSPENDED:'red',SHELL_SITE:'orange',CROSS_DOMAIN_REDIRECT:'red',POLITICAL_CAMPAIGN:'blue' }[v] || 'orange'; }

function verdictEmoji(v) { return { VALID:'‚úÖ',PARKED:'üÖøÔ∏è',COMING_SOON:'üöß',NO_CONTENT:'üì≠',REDIRECT_HOST:'‚Ü™Ô∏è',DEFAULT_PAGE:'üìÑ',SUSPENDED:'üö´',SHELL_SITE:'üèóÔ∏è',CROSS_DOMAIN_REDIRECT:'‚ö†Ô∏è',POLITICAL_CAMPAIGN:'üèõÔ∏è' }[v] || '‚ùì'; }
</script>
</body>
</html>
